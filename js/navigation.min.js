!function(e){"use strict";function n(){return matchMedia("(min-width:768px)").matches}Function.prototype.bind||(Function.prototype.bind=function(){var e=this,n=Array.prototype.slice.call(arguments),t=n.shift();return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}});var t=function(){return function(n,t){var a,i=this;i.defaults={menutype:"dropdown",animationSpeed:400,toggle:"toggle-menu",menu:"cm-menu",htmlClass:"cm-js-menu-active",expanderText:"expand / collapse",landings:!1,expanders:!1,singleClick:!0,fadeObject:"#cmlla"},a=e(n).data()||{},i.options=e.extend({},i.defaults,a,t),i.menu=n,i.$menu=e(n),i.$menuBar=i.$menu.find("."+i.options.menu),i.$menuToggle=i.$menu.find("."+i.options.toggle),i.isActive=!1,i.lastEventType,i.currentFocus=0,i.initialLinks=[],i.currentLinks=[],i.keyHandler=e.proxy(i.keyHandler,i),i.showMenu=e.proxy(i.showMenu,i),i.hideMenu=e.proxy(i.hideMenu,i),i.menuToggle=e.proxy(i.menuToggle,i),i.fadeToggle=e.proxy(i.fadeToggle,i),i.subMenuToggle=e.proxy(i.subMenuToggle,i),i.menuHandler=e.proxy(i.menuHandler,i),i.menuToggleHandler=e.proxy(i.menuToggleHandler,i),i.init()}}();t.prototype.init=function(){var n=this;n.$menuToggle.on("click touchstart",n.menuToggle),n.$menu.addClass("cm-js-enabled").attr({role:"navigation",tabindex:"0"}),n.$menuBar.attr("role","menubar");var t=1;if(e("[id^='cm-dropdown']").last().length>0){var a=0;e("[id^='cm-dropdown']").each(function(){var n=e(this).attr("id").split("dropdown")[1];a=n&&a<parseInt(n,10)?parseInt(n,10):a}),t=a+1}n.$menu.on("keydown",n.keyHandler),n.$menu.on("focus",function(){n.$menuToggle.is(":visible")&&!n.isActive&&n.showMenu(),n.$menu.hasClass("cm-js-inFocus")||n.isActive||(n.$menu.addClass("cm-js-inFocus").attr("tabindex","-1"),n.currentLinks[n.currentFocus].attr("tabindex","0").focus())}),n.initialLinks=[],n.$menu.find("."+n.options.menu+" a").each(function(){var a=e(this),i=a.closest("li");if(a.attr({role:"menuitem",tabindex:"-1"}),i.attr("role","presentation"),!i.data("type")&&i.parent().hasClass(n.options.menu)&&i.attr("data-type",n.options.menutype),a.siblings().not("a").length>0){var s=a.siblings(),o="cm-dropdown"+t;if(n.options.expanders){var r=e("<a id='"+o+"' href='#' role='menuitem' aria-haspopup='true' class='has-sub' tabindex='-1'><span><span class='visually-hidden'>"+n.options.expanderText+"</span></span></a>");a.wrap("<div class='expander-wrap'></div>").after(r),r.on("click",n.subMenuToggle)}else a.attr("id")?o=a.attr("id"):a.attr("id","cm-dropdown"+t),a.attr({"aria-haspopup":"true"}).addClass("has-sub").on("click",n.subMenuToggle);var u=s.height()>0;if(s.attr({role:"menu","aria-expanded":u,"aria-hidden":!u,"aria-labelledby":o}),n.options.landings&&!n.options.expanders){var l=e(s.is("ul")?"<li class='link-landing'>"+a.get(0).outerHTML+"</li>":"<div class='link-landing'>"+a.get(0).outerHTML+"</div>");l.children().removeAttr("aria-haspopup class id"),l.find("a").removeClass("has-sub"),s.prepend(l)}if(i.data("type")&&"sliding"===i.data("type")){var c=e("<div class='sub-menu cm-js-inactive'></div>");s.wrap(c);var d=function(){var e,t=n.$menu.innerWidth(),a=i.position().left;(e=i.children(".sub-menu")).find("> ul > li > ul").innerWidth(t),e.innerWidth(t).css("left","-"+a+"px")},m=function(e,n,t){var a;return function(){var i=this,s=arguments,o=t&&!a;clearTimeout(a),a=setTimeout(function(){a=null,t||e.apply(i,s)},n),o&&e.apply(i,s)}}(d,300);e(window).load(function(){d(),e(window).resize(m)})}o==="cm-dropdown"+t&&t++}a.closest("[role]:not(a)").data("type")&&(n.initialLinks.push(a),n.options.expanders&&n.initialLinks.push(r))}),n.currentLinks=n.initialLinks},t.prototype.keyHandler=function(e){var n=this;if(n.$menu.hasClass("cm-js-inFocus")||n.$menu.addClass("cm-js-inFocus").attr("tabindex","-1"),37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode){e.preventDefault();var t=n.currentLinks[n.currentFocus];if(t){var a,i,s,o,r=t.closest("[role]:not(a)").attr("data-type"),u=t.closest("[role=menu]:not(a)").closest("[role=presentation]").attr("data-type");r?37===e.keyCode?i="prev":39===e.keyCode?i="next":40!==e.keyCode&&38!==e.keyCode||(o=!0):38===e.keyCode?i="prev":40===e.keyCode?i="next":39===e.keyCode?o=!0:u||37!==e.keyCode||(s=!0),i&&(n.currentFocus="prev"===i?n.currentFocus-1>=0?n.currentFocus-1:n.currentLinks.length-1:n.currentFocus+1<n.currentLinks.length?n.currentFocus+1:0,a=n.currentLinks[n.currentFocus]),a?(t.attr("tabindex","-1"),n.currentLinks[n.currentFocus].attr("tabindex","0").focus()):s?n.$menu.find(".opened").last().find("[aria-haspopup]").first().trigger("click"):o&&(t.closest("li").hasClass("clicked")||n.currentLinks[n.currentFocus].trigger("click"))}}else 27===e.keyCode?(e.preventDefault(),n.$menu.find(".opened").last().find("[aria-haspopup]").first().trigger("click")):32===e.keyCode&&(e.preventDefault(),n.currentLinks[n.currentFocus].trigger("click"))},t.prototype.cleanUpEvents=function(){var n=this;n.$menu.find("li a").off("click",n.subMenuToggle),n.$menu.find("li a[tabindex=0]").attr("tabindex","-1"),n.$menu.off("focus"),n.$menu.off("keydown",n.keyHandler),e("html").off("click touchstart focusin",n.menuHandler),e("html").off("click touchstart",n.menuToggleHandler)},t.prototype.destroy=function(){var e=this;e.$menu.removeClass("cm-js-enabled cm-js-inFocus"),e.$menu.find("li").removeClass("opened animating animated"),e.cleanUpEvents()},t.prototype.showMenu=function(){var t=this;t.isActive=!0,t.$menu.addClass("cm-js-active"),t.$menuToggle.addClass("active"),e("html").addClass(t.options.htmlClass),t.$menu.focus(),e("html").off("click touchstart",t.menuToggleHandler),n()&&setTimeout(function(){e("html").addClass(t.options.htmlClass).on("click touchstart focusin",t.menuToggleHandler)},t.options.animationSpeed),t.fadeToggle(!0)},t.prototype.hideMenu=function(){var t=this;t.isActive=!1,t.$menu.removeClass("cm-js-active cm-js-inFocus"),t.$menuToggle.removeClass("active"),n()&&e("html").removeClass(t.options.htmlClass).addClass("cm-animate-out").off("click touchstart focusin",t.menuToggleHandler),setTimeout(function(){e("html").removeClass("cm-animate-out")},t.options.animationSpeed),t.fadeToggle(!0)},t.prototype.menuToggle=function(e){var n=this;e.preventDefault(),"touchstart"===n.lastEventType&&"click"===e.type||(n.isActive?n.hideMenu():n.showMenu()),n.lastEventType=e.type},t.prototype.fadeToggle=function(n,t){var a=this,i=e(a.$menu),s=e(a.options.fadeObject);n?s.toggleClass("activeMobi"):i.find(".toggle-menu").is(":visible")||(t&&s.hasClass("active")&&!i.find(".cm-menu>li").hasClass("opened")?(s.removeClass("active"),setTimeout(function(){s.removeClass("opened")},a.options.animationSpeed)):!s.hasClass("active")&&i.find(".cm-menu>li").hasClass("opened")&&s.addClass("opened active"))},t.prototype.subMenuToggle=function(t){var a=this,i=e(t.currentTarget),s=i.closest("li"),o=i.closest("[data-type]").data("type"),r=e("[aria-labelledby="+i.attr("id")+"]");s.hasClass("opened")?(e("html").off("click touchstart focusin",a.menuHandler),a.options.singleClick&&(t.preventDefault(),"sliding"===o&&s.parents(".sub-menu").hasClass("sub-menu")&&s.parents(".sub-menu").addClass("cm-js-inactive"),s.removeClass("opened animating animated"),a.$menu.find(".opened").length>0&&e("html").on("click touchstart focusin",a.menuHandler),r.attr({"aria-expanded":"false","aria-hidden":"true"}),e.each(a.currentLinks,function(){this.attr("tabindex","-1")}),a.currentLinks=[],setTimeout(function(){if(s.data("type"))a.currentLinks=a.initialLinks,a.currentFocus=s.index();else{var n=0;s.closest("[role=menu]").find("a").each(function(t,s){var o=e(s);o.closest("[role=menu]").height()>10&&o.closest("[role=menu]").width()>10&&(a.currentLinks.push(o),i.attr("id")===o.attr("id")&&(a.currentFocus=n),n++)})}i.attr("tabindex","0").focus()},a.options.animationSpeed)),a.fadeToggle(!1,!0)):(t.preventDefault(),s.addClass("opened animating").siblings().removeClass("opened animating animated").find(".opened").removeClass("opened animating animated"),s.siblings().find(".sub-menu").addClass("cm-js-inactive"),"sliding"===o&&s.parents(".sub-menu").length>0&&s.parents(".sub-menu").removeClass("cm-js-inactive"),r.attr({"aria-expanded":"true","aria-hidden":"false"}),e.each(a.currentLinks,function(){this.attr("tabindex","-1")}),a.currentLinks=[],setTimeout(function(){s.hasClass("animating")&&s.removeClass("animating").addClass("animated"),s.find("[role=menu]").first().find("a").each(function(n,t){var i=e(t);i.closest("[role=menu]").height()>10&&i.closest("[role=menu]").width()>10&&a.currentLinks.push(i)}),"false"==s.find(".sub-menu-list").first().attr("aria-expanded")&&a.currentLinks[0].trigger("click"),"sub-menu cm-js-inactive"==s.find(".sub-menu").attr("class")&&a.currentLinks[0].trigger("click"),a.currentFocus=0,a.currentLinks[a.currentFocus].attr("tabindex","0").focus(),n()&&e("html").on("click touchstart focusin",a.menuHandler)},a.options.animationSpeed),a.fadeToggle(!1,!1))},t.prototype.menuToggleHandler=function(n){var t=this;e.contains(t.menu,n.target)||(t.$menu.find("."+t.options.toggle).trigger("click"),e("html").removeClass(t.options.htmlClass).off("click touchstart",t.menuToggleHandler))},t.prototype.menuHandler=function(n){var t=this;e.contains(t.menu,n.target)||t.$menu.is(e(n.target))||(t.$menu.find(".opened").removeClass("opened animated animating"),t.$menu.find("[role=menu]").attr({"aria-expanded":"false","aria-hidden":"false"}),t.$menu.find(".sub-menu").addClass("cm-js-inactive"),t.$menu.find("li a[tabindex=0]").attr("tabindex","-1"),t.currentLinks=t.initialLinks,t.currentFocus=0,e(".cm-js-inFocus").removeClass("cm-js-inFocus").attr("tabindex","0"),e("html").off("click touchstart focusin",t.menuHandler),t.fadeToggle(!1,!0))},e.fn.clickMenu=function(){var e,n=this,a=arguments[0],i=Array.prototype.slice.call(arguments,1),s=n.length,o=0;for(o;o<s;o++)if("object"==typeof a||void 0===a?n[o].clickMenu=new t(n[o],a):e=n[o].clickMenu[a].apply(n[o].clickMenu,i),void 0!==e)return e;return n}}(jQuery);